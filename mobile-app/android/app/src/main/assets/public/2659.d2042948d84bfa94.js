"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2659],{2659:(w,I,s)=>{s.r(I),s.d(I,{FavoritePageModule:()=>T});var u=s(9351),o=s(7199),h=s(7473),A=s(4170),U=s(5841),S=s(8580),r=s(315),m=s(1301),F=s(1851),a=s(5109),e=s(878),i=s(496),d=s(6200),_=s(6e3);let y=(()=>{var c;class f{constructor(t){this.http=t,this.apiUrl=`${e.c.apiUrl}/api`,i.A.interceptors.request.use(n=>{const v=localStorage.getItem("token");return v&&(n.headers.Authorization=`Bearer ${v}`),n},n=>Promise.reject(n))}getServices(){return(0,a.H)(i.A.get(`${this.apiUrl}/services`)).pipe((0,d.T)(t=>t.data))}getServiceById(t){return(0,a.H)(i.A.get(`${this.apiUrl}/services/${t}`)).pipe((0,d.T)(n=>n.data))}getServicesByProviderId(t){return(0,a.H)(i.A.get(`${this.apiUrl}/services/providers/${t}/services`)).pipe((0,d.T)(n=>n.data))}}return(c=f).\u0275fac=function(t){return new(t||c)(r.KVO(_.Qq))},c.\u0275prov=r.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}),f})();var C=s(5822),E=s(8525);function R(c,f){if(1&c){const p=r.RV6();r.j41(0,"div",9),r.bIt("click",function(){const n=r.eBV(p).$implicit,v=r.XpG();return r.Njj(v.navigateToDetails(n))}),r.j41(1,"div",10),r.nrm(2,"img",11),r.k0s(),r.j41(3,"div",12)(4,"div",13)(5,"ion-label",14),r.EFF(6),r.k0s()(),r.j41(7,"img",15),r.bIt("click",function(n){const v=r.eBV(p).$implicit;return r.XpG().toggleFavorite(v),r.Njj(n.stopPropagation())}),r.k0s()()()}if(2&c){const p=f.$implicit;r.R7$(2),r.FS9("alt",p.name),r.Y8G("src",p.image,r.B4B),r.R7$(4),r.JRh(p.name)}}const D=[{path:"",component:(()=>{var c;class f{constructor(t,n,v,g,$,l,P){this.favService=t,this.productService=n,this.serviceService=v,this.router=g,this.toastController=$,this.authService=l,this.providerService=P,this.items=[]}ngOnInit(){this.loadFavorites()}loadFavorites(){var t=this;return(0,U.A)(function*(){try{const v=(yield t.authService.fetchProfileData()).id;t.favService.getFavsByPetOwnerId(v).subscribe(function(){var g=(0,U.A)(function*($){for(const l of $)l.product_id?yield t.productService.getProductById(l.product_id).subscribe(P=>{t.items.push({id:l.id,product_id:l.product_id,name:P.name,image:P.images[0],isFavorite:!0}),console.log("Product loaded:",t.items[t.items.length-1])}):l.service_id?yield t.serviceService.getServiceById(l.service_id).subscribe(P=>{t.items.push({id:l.id,service_id:l.service_id,name:P.title,image:P.image,isFavorite:!0}),console.log("Service loaded:",t.items[t.items.length-1])}):l.provider_id&&(yield t.providerService.getProviderById(l.provider_id).then(P=>{const B=P.data;if(Array.isArray(B)&&B.length>0){const O=B[0];console.log("Parsed provider:",O),t.items.push({id:l.id,provider_id:l.provider_id,name:O.name,image:O.profile_image,isFavorite:!0}),console.log("Provider loaded:",t.items[t.items.length-1])}else console.error("Provider array is empty or invalid:",B)}).catch(P=>{console.error("Error fetching provider:",P)}));console.log("Favorites loaded:",t.items)});return function($){return g.apply(this,arguments)}}(),g=>{console.error("Error fetching favorites:",g)})}catch(n){console.error("Error loading profile or favorites:",n)}})()}toggleFavorite(t){var n=this;return(0,U.A)(function*(){try{if(t.isFavorite)yield n.favService.deleteFav(t.id).toPromise(),t.isFavorite=!1,yield(0,S.P)(n.toastController,"Item removed from favorites","danger");else{const v={pet_owner_id:(yield n.authService.fetchProfileData()).id,product_id:t.product_id,service_id:t.service_id,provider_id:t.provider_id},g=yield n.favService.createFav(v).toPromise();g?(t.id=g.id,t.isFavorite=!0,yield(0,S.P)(n.toastController,"Item added to favorites","success")):yield(0,S.P)(n.toastController,"Failed to add item to favorites","danger")}}catch(v){console.error("Error toggling favorite:",v),yield(0,S.P)(n.toastController,"Failed to update favorite status","danger")}})()}navigateToDetails(t){var n=this;return(0,U.A)(function*(){if(t.product_id)n.router.navigate(["/product-details",t.product_id]);else if(t.service_id)n.router.navigate(["/providerservice",t.service_id]);else if(t.provider_id)try{const g=(yield n.providerService.getProviderById(t.provider_id)).data;if(Array.isArray(g)&&g.length>0){const $=g[0];if($&&$.type){const l=$.type.toLowerCase();switch(l){case"pet shop":n.router.navigate(["/vetdetails/petstores/",t.provider_id]);break;case"groomer":n.router.navigate(["/vetdetails/groomer",t.provider_id]);break;case"trainer":n.router.navigate(["/vetdetails/trainer/",t.provider_id]);break;case"doctor":n.router.navigate(["/vetdetails/doctor/",t.provider_id]);break;case"pet clinic":n.router.navigate(["/vetdetails/vetclinic/",t.provider_id]);break;default:console.error("Unknown provider type:",l)}}else console.error("Provider type is missing or invalid:",$)}else console.error("Provider array is empty or invalid:",g)}catch(v){console.error("Error fetching provider:",v)}})()}}return(c=f).\u0275fac=function(t){return new(t||c)(r.rXU(m.L),r.rXU(F.b),r.rXU(y),r.rXU(A.Ix),r.rXU(h.K_),r.rXU(C.u),r.rXU(E.$))},c.\u0275cmp=r.VBU({type:c,selectors:[["app-favorite"]],decls:15,vars:1,consts:[["slot","start"],[1,"header-margin-Single-Line"],[1,"titleFont"],["slot","end"],["src","assets/icons/filter.svg",1,"icon"],[1,"ion-padding"],[1,"MakeItCenter"],[1,"MakeItAGride","favoriteContainer"],["class","product-item",3,"click",4,"ngFor","ngForOf"],[1,"product-item",3,"click"],[1,"imgContainer"],[3,"src","alt"],[1,"FlexSpaceInBetween"],[1,"titleContainer"],[1,"bodyFont","boldFont","vetClinicTitle"],["src","assets/heartr.svg",1,"icon",3,"click"]],template:function(t,n){1&t&&(r.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),r.nrm(3,"ion-back-button"),r.k0s(),r.j41(4,"div",1)(5,"ion-label",2),r.EFF(6,"Favorite"),r.k0s()(),r.j41(7,"ion-buttons",3)(8,"ion-button"),r.nrm(9,"img",4),r.k0s()()()(),r.j41(10,"ion-content",5)(11,"div",6)(12,"div")(13,"div",7),r.DNE(14,R,8,3,"div",8),r.k0s()()()()),2&t&&(r.R7$(14),r.Y8G("ngForOf",n.items))},dependencies:[u.Sq,h.Jm,h.QW,h.W9,h.eU,h.he,h.ai,h.el],styles:["ion-buttons[_ngcontent-%COMP%]{margin-top:20px}.icon[_ngcontent-%COMP%]{width:24px;height:auto}.favoriteContainer[_ngcontent-%COMP%]{max-width:350px}.product-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:5px;padding:10px;border-radius:16px;background-color:var(--White)}.imgContainer[_ngcontent-%COMP%]{width:100%;height:70%;margin-bottom:10px;border-radius:16px;position:relative;overflow:hidden}.imgContainer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;border-radius:16px;height:auto;object-fit:cover;object-position:center}.titleContainer[_ngcontent-%COMP%]{width:80%}.vetClinicTitle[_ngcontent-%COMP%]{margin-bottom:3px}"]}),f})()}];let M=(()=>{var c;class f{}return(c=f).\u0275fac=function(t){return new(t||c)},c.\u0275mod=r.$C({type:c}),c.\u0275inj=r.G2t({imports:[A.iI.forChild(D),A.iI]}),f})(),T=(()=>{var c;class f{}return(c=f).\u0275fac=function(t){return new(t||c)},c.\u0275mod=r.$C({type:c}),c.\u0275inj=r.G2t({imports:[u.MD,o.YN,h.bv,M]}),f})()},5822:(w,I,s)=>{s.d(I,{u:()=>S});var u=s(5841),o=s(496),h=s(878),A=s(315),U=s(6e3);o.A.defaults.withCredentials=!0;let S=(()=>{var r;class m{constructor(a){this.http=a,this.apiUrl=h.c.apiUrl}getCSRFToken(){return o.A.get(`${this.apiUrl}/sanctum/csrf-cookie`)}register(a){var e=this;return(0,u.A)(function*(){return yield e.getCSRFToken(),o.A.post(`${e.apiUrl}/api/register`,a).then(i=>(localStorage.setItem("token",i.data.token),i.data)).catch(i=>{throw console.error("Login error:",i),i})})()}checkEmail(a){return o.A.post(`${this.apiUrl}/api/check-email`,{email:a})}sendVerificationCode(a){return o.A.post(`${this.apiUrl}/api/send-verification-code`,{email:a})}verifyCode(a){return o.A.post(`${this.apiUrl}/api/verify-code`,a)}login(a){var e=this;return(0,u.A)(function*(){return yield e.getCSRFToken(),o.A.post(`${e.apiUrl}/api/login`,a).then(i=>(localStorage.setItem("token",i.data.token),i.data)).catch(i=>{throw console.error("Login error:",i),i})})()}logout(){const a=localStorage.getItem("token");return o.A.post(`${this.apiUrl}/api/logout`,{},{headers:{Authorization:`Bearer ${a}`}}).then(()=>{localStorage.removeItem("token")})}getProfile(){var a=this;return(0,u.A)(function*(){const e=localStorage.getItem("token");return(yield o.A.get(`${a.apiUrl}/api/petOwner/profile`,{headers:{Authorization:`Bearer ${e}`}})).data.data})()}fetchProfileData(){var a=this;return(0,u.A)(function*(){try{const e=yield a.getProfile();return console.log("Profile response:",e),e}catch(e){throw console.error("Error fetching profile:",e),e}})()}getPetOwnerData(a){const e=localStorage.getItem("token");return o.A.get(`${this.apiUrl}/api/pet_owner/${a}`,{headers:{Authorization:`Bearer ${e}`}})}fetchPetOwnerData(a){return console.log("th id in auth=====>",a),this.getPetOwnerData(a).then(e=>(console.log("pet owner data:",e),e.data.data)).catch(e=>{throw console.error("Error fetching pet owner:",e),e})}updateProfile(a,e){const i=localStorage.getItem("token");return o.A.put(`${this.apiUrl}/api/pet_owner/${e}`,a,{headers:{Authorization:`Bearer ${i}`}})}updateProfileImage(a,e){const i=localStorage.getItem("token");return o.A.post(`${this.apiUrl}/api/pet_owner/image/${e}`,a,{headers:{Authorization:`Bearer ${i}`}})}updatePass(a,e,i){var d=this;return(0,u.A)(function*(){const _=localStorage.getItem("token");try{return(yield o.A.put(`${d.apiUrl}/api/pet-owners/update-password`,{email:a,password:e,password_confirmation:i},{headers:{Authorization:`Bearer ${_}`}})).data}catch(y){throw console.error("Error updating password:",y),y}})()}}return(r=m).\u0275fac=function(a){return new(a||r)(A.KVO(U.Qq))},r.\u0275prov=A.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),m})()},8525:(w,I,s)=>{s.d(I,{$:()=>r});var u=s(5841),o=s(496),h=s(878),A=s(5109),U=s(6200),S=s(315);o.A.defaults.withCredentials=!0;let r=(()=>{var m;class F{constructor(){this.apiUrl=`${h.c.apiUrl}/api`,o.A.interceptors.request.use(e=>{const i=localStorage.getItem("token");return i&&(e.headers.Authorization=`Bearer ${i}`),e},e=>Promise.reject(e))}getAllProviders(){return o.A.get(`${this.apiUrl}/providers`)}getProviderById(e){return o.A.get(`${this.apiUrl}/providers/${e}`)}getProviderById2(e){return(0,A.H)(o.A.get(`${this.apiUrl}/providers/${e}`)).pipe((0,U.T)(i=>i.data))}createProvider(e){return o.A.post(`${this.apiUrl}/providers`,e)}getAllProviders2(){var e=this;return(0,u.A)(function*(){return o.A.get(`${e.apiUrl}/providers`).then(i=>i.data)})()}updateProvider(e,i){return o.A.put(`${this.apiUrl}/providers/${e}`,i)}deleteProvider(e){return o.A.delete(`${this.apiUrl}/providers/${e}`)}getServicesByProviderId(e){return o.A.get(`${this.apiUrl}/providers/${e}/services`)}getProductsByProviderId(e){return o.A.get(`${this.apiUrl}/providers/${e}/products`)}getVeterinariansByProviderId(e){return o.A.get(`${this.apiUrl}/providers/${e}/veterinarians`)}getVeterianById(e){return o.A.get(`${this.apiUrl}/veterinarians/${e}`)}getServiceById(e){return o.A.get(`${this.apiUrl}/services/${e}`)}getProductById(e){return o.A.get(`${this.apiUrl}/products/${e}`)}getServiceReviewsByServiceId(e){return o.A.get(`${this.apiUrl}/services/${e}/reviews`)}getPetOwnerById(e){return o.A.get(`${this.apiUrl}/pet_owners/${e}`)}getProductReviewsByProductId(e){return o.A.get(`${this.apiUrl}/products/${e}/reviews`)}getProviderByName(e){return(0,A.H)(o.A.get(`${this.apiUrl}/providers/name/${e}`))}addReview(e){var i=this;return(0,u.A)(function*(){try{console.log("Review data before sending:",e);const d=yield o.A.post(`${i.apiUrl}/reviews`,e);return console.log("Server response:",d.data),d.data}catch(d){throw console.error("Error adding review:",d),d}})()}getAverageRatingByProviderId(e){var i=this;return(0,u.A)(function*(){try{const _=(yield i.getServicesByProviderId(e)).data;let y=0,C=0;for(const R of _)(yield i.getServiceReviewsByServiceId(R.id)).data.forEach(M=>{C+=M.rate,y++});return y>0?C/y:0}catch(d){throw console.error("Error calculating average rating:",d),d}})()}getAverageRatingByProductId(e){var i=this;return(0,u.A)(function*(){try{const _=(yield o.A.get(`${i.apiUrl}/products/${e}/reviews`)).data;return 0===_.length?null:_.reduce((C,E)=>C+E.rate,0)/_.length}catch(d){throw console.error("Error fetching reviews:",d),d}})()}}return(m=F).\u0275fac=function(e){return new(e||m)},m.\u0275prov=S.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),F})()}}]);