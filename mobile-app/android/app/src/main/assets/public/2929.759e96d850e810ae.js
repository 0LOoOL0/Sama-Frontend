"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2929],{2929:(M,O,c)=>{c.r(O),c.d(O,{ReviewPageModule:()=>$});var h=c(9351),r=c(7199),u=c(7473),P=c(4170),A=c(5841),e=c(315),_=c(8525),m=c(5822);const y=()=>[1,2,3,4,5];function a(s,p){if(1&s&&(e.j41(0,"div",23),e.qSk(),e.j41(1,"svg",24),e.nrm(2,"path",25),e.k0s()()),2&s){const l=p.$implicit,i=e.XpG().$implicit;e.R7$(),e.BMQ("fill",l<=i.rate?"#F0A441":"#9da4aa")}}function t(s,p){if(1&s&&(e.j41(0,"div")(1,"div",14)(2,"div",15)(3,"div",16)(4,"div",17)(5,"div",18),e.nrm(6,"img",19),e.k0s()(),e.j41(7,"div",20)(8,"ion-label",21),e.EFF(9),e.k0s(),e.j41(10,"div",11),e.DNE(11,a,3,1,"div",12),e.k0s()()(),e.j41(12,"ion-label",7),e.EFF(13),e.k0s()(),e.j41(14,"div",22)(15,"ion-label",7),e.EFF(16),e.k0s()()()()),2&s){const l=p.$implicit;e.R7$(6),e.Y8G("src",null==l.petOwner?null:l.petOwner.profile_image,e.B4B),e.R7$(3),e.JRh(null==l.petOwner?null:l.petOwner.first_name),e.R7$(2),e.Y8G("ngForOf",e.lJ4(5,y)),e.R7$(2),e.JRh(l.date),e.R7$(3),e.JRh(l.comment)}}function o(s,p){if(1&s){const l=e.RV6();e.j41(0,"div",23),e.qSk(),e.j41(1,"svg",26),e.bIt("click",function(){const n=e.eBV(l).$implicit,d=e.XpG();return e.Njj(d.setRating(n))}),e.nrm(2,"path",25),e.k0s()()}if(2&s){const l=p.$implicit,i=e.XpG();e.R7$(),e.BMQ("fill",l<=i.rating?"#F0A441":"#9da4aa")}}const R=[{path:"",component:(()=>{var s;class p{constructor(i,n,d,v){this.activatedRoute=i,this.providerService=n,this.authService=d,this.fb=v,this.rating=0,this.reviews=[],this.reviewsDraft=[{name:"Charolette Hanlin",rating:5,comment:"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore...",timeAgo:"4 months ago",avatar:"assets/avatar1.png"},{name:"Charolette Hanlin",rating:5,comment:"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore...",timeAgo:"4 months ago",avatar:"assets/avatar1.png"}],this.reviewForm=this.fb.group({comment:["",r.k0.required],rating:[0,r.k0.required]})}ngOnInit(){var i=this;return(0,A.A)(function*(){i.type=i.activatedRoute.snapshot.paramMap.get("type"),i.Id=+i.activatedRoute.snapshot.paramMap.get("id"),i.Id&&"service"===i.type&&i.loadServiceReviews(i.Id),i.Id&&"product"===i.type&&i.loadProductReviews(i.Id),i.reviewForm=i.fb.group({comment:["",r.k0.required],rate:[0,r.k0.required],date:[(new Date).toISOString().split("T")[0],r.k0.required],pet_owner_id:[null,r.k0.required]});try{const n=yield i.authService.getProfile();i.petOwnerId=n.id,i.reviewForm.patchValue({pet_owner_id:i.petOwnerId})}catch(n){console.error("Error fetching profile data:",n)}})()}loadServiceReviews(i){var n=this;return(0,A.A)(function*(){try{const d=yield n.providerService.getServiceReviewsByServiceId(i);console.log("Reviews fetched successfully:",d.data),n.reviews=d.data.sort((v,w)=>new Date(w.created_at).getTime()-new Date(v.created_at).getTime());for(const v of n.reviews)if(v.pet_owner_id)try{const w=yield n.loadPetOwner(v.pet_owner_id);v.petOwner=w}catch(w){console.error("Error fetching pet owner for review:",w)}}catch(d){console.error("Error fetching reviews:",d)}})()}loadProductReviews(i){var n=this;return(0,A.A)(function*(){try{const d=yield n.providerService.getProductReviewsByProductId(i);console.log("Reviews fetched successfully:",d.data),n.reviews=d.data.sort((v,w)=>new Date(w.created_at).getTime()-new Date(v.created_at).getTime());for(const v of n.reviews)if(v.pet_owner_id)try{const w=yield n.loadPetOwner(v.pet_owner_id);v.petOwner=w}catch(w){console.error("Error fetching pet owner for review:",w)}}catch(d){console.error("Error fetching reviews:",d)}})()}loadPetOwner(i){return this.providerService.getPetOwnerById(i).then(n=>Array.isArray(n.data)?n.data[0]:n.data).catch(n=>{throw console.error("Error fetching pet owner details:",n),n})}setRating(i){this.rating===i?this.rating-=1:this.rating=i,this.reviewForm.patchValue({rate:this.rating}),console.log("New rating value:",this.rating),this.reviewForm.patchValue({rate:this.rating})}submitReview(){if(console.log("Form Valid:",this.reviewForm.valid),console.log("Form Values:",this.reviewForm.value),console.log("Form Errors:",this.reviewForm.errors),this.reviewForm.valid){var i,n;const d={...this.reviewForm.value,service_id:"service"===this.type&&null!==(i=this.Id)&&void 0!==i?i:null,product_id:"product"===this.type&&null!==(n=this.Id)&&void 0!==n?n:null};console.log("Submitting review with data:",d),this.providerService.addReview(d).then(v=>{console.log("Review submitted successfully:",v.data),this.reviewForm.reset(),this.rating=0,this.reviewForm.patchValue({pet_owner_id:this.petOwnerId,date:(new Date).toISOString().split("T")[0]}),this.Id&&"service"===this.type?this.loadServiceReviews(this.Id):this.Id&&"product"===this.type&&this.loadProductReviews(this.Id)}).catch(v=>{console.error("Error submitting review:",v)})}else console.warn("Form is invalid:",this.reviewForm.errors)}}return(s=p).\u0275fac=function(i){return new(i||s)(e.rXU(P.nX),e.rXU(_.$),e.rXU(m.u),e.rXU(r.ok))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-review"]],decls:22,vars:5,consts:[["slot","start"],[1,"header-margin-Single-Line"],[1,"titleFont"],[1,"ion-padding"],[4,"ngFor","ngForOf"],[1,"Form",3,"ngSubmit","formGroup"],[1,"comment","MakeItFlex"],[1,"bodyFont"],["fill","solid","formControlName","comment",1,"bodyFont"],[1,"Rate","FlexSpaceInBetween","MakeItFlex"],[1,"star-rating"],[1,"stars-container"],["class","star",4,"ngFor","ngForOf"],["type","submit","expand","full","fill","clear",1,"FilledButtons",3,"disabled"],[1,"ReviewContainer"],[1,"FlexSpaceInBetween"],[1,"MakeItFlex"],[1,"square"],[1,"parent"],["alt","Avatar",3,"src"],[1,"column"],[1,"bodyFont","boldFont"],[1,"Margin-Top"],[1,"star"],["viewBox","0 0 1024 1024","xmlns","http://www.w3.org/2000/svg","stroke","rgba(0, 0, 0, 0.3)",1,"icon"],["d","M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 0 0 .6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0 0 46.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z"],["viewBox","0 0 1024 1024","xmlns","http://www.w3.org/2000/svg","stroke","rgba(0, 0, 0, 0.3)",1,"icon",3,"click"]],template:function(i,n){1&i&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e.nrm(3,"ion-back-button"),e.k0s(),e.j41(4,"div",1)(5,"ion-title",2),e.EFF(6,"Reviews"),e.k0s()()()(),e.j41(7,"ion-content",3),e.DNE(8,t,17,6,"div",4),e.k0s(),e.j41(9,"form",5),e.bIt("ngSubmit",function(){return n.submitReview()}),e.j41(10,"div",6)(11,"ion-label",7),e.EFF(12,"Comment"),e.k0s(),e.nrm(13,"ion-input",8),e.k0s(),e.j41(14,"div",9)(15,"ion-label",7),e.EFF(16,"Rating"),e.k0s(),e.j41(17,"div",10)(18,"div",11),e.DNE(19,o,3,1,"div",12),e.k0s()()(),e.j41(20,"ion-button",13),e.EFF(21,"Submit Review"),e.k0s()()),2&i&&(e.R7$(8),e.Y8G("ngForOf",n.reviews),e.R7$(),e.Y8G("formGroup",n.reviewForm),e.R7$(10),e.Y8G("ngForOf",e.lJ4(4,y)),e.R7$(),e.Y8G("disabled",!n.reviewForm.valid))},dependencies:[h.Sq,r.qT,r.BC,r.cb,r.j4,r.JD,u.Jm,u.QW,u.W9,u.eU,u.$w,u.he,u.BC,u.ai,u.Gw,u.el],styles:["ion-buttons[_ngcontent-%COMP%]{margin-top:20px}.column[_ngcontent-%COMP%]{display:flex;flex-direction:column}.icon[_ngcontent-%COMP%]{width:24px;height:auto}.Margin-Top[_ngcontent-%COMP%]{margin-top:10px}.ReviewContainer[_ngcontent-%COMP%]{width:100%;border-radius:16px;margin:10px 0;padding:16px;background-color:var(--White)}.square[_ngcontent-%COMP%]{width:50px;height:50px;margin-right:5px}.square[_ngcontent-%COMP%]   .parent[_ngcontent-%COMP%]{width:50px;height:50px;position:relative;border-radius:50%;overflow:hidden}.square[_ngcontent-%COMP%]   .parent[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;background-size:cover;background-position:center}.stars-container[_ngcontent-%COMP%]{display:inline-flex;align-items:center;margin-right:3px}.star[_ngcontent-%COMP%]{margin-right:3px}.Form[_ngcontent-%COMP%]{margin:0 16px;padding-top:10px}.Rate[_ngcontent-%COMP%], .comment[_ngcontent-%COMP%]{background-color:var(--White);border-radius:16px}.Rate[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], .comment[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-left:15px}.Rate.Rate[_ngcontent-%COMP%], .comment.Rate[_ngcontent-%COMP%]{margin-top:5px;margin-bottom:5px;padding:14px 16px}.Rate.comment[_ngcontent-%COMP%], .comment.comment[_ngcontent-%COMP%]{padding-left:14px;padding-top:5px;padding-right:10px}"]}),p})()}];let f=(()=>{var s;class p{}return(s=p).\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[P.iI.forChild(R),P.iI]}),p})(),$=(()=>{var s;class p{}return(s=p).\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[h.MD,r.YN,r.X1,u.bv,f]}),p})()},5822:(M,O,c)=>{c.d(O,{u:()=>e});var h=c(5841),r=c(496),u=c(878),P=c(315),A=c(6e3);r.A.defaults.withCredentials=!0;let e=(()=>{var _;class m{constructor(a){this.http=a,this.apiUrl=u.c.apiUrl}getCSRFToken(){return r.A.get(`${this.apiUrl}/sanctum/csrf-cookie`)}register(a){var t=this;return(0,h.A)(function*(){return yield t.getCSRFToken(),r.A.post(`${t.apiUrl}/api/register`,a).then(o=>(localStorage.setItem("token",o.data.token),o.data)).catch(o=>{throw console.error("Login error:",o),o})})()}checkEmail(a){return r.A.post(`${this.apiUrl}/api/check-email`,{email:a})}sendVerificationCode(a){return r.A.post(`${this.apiUrl}/api/send-verification-code`,{email:a})}verifyCode(a){return r.A.post(`${this.apiUrl}/api/verify-code`,a)}login(a){var t=this;return(0,h.A)(function*(){return yield t.getCSRFToken(),r.A.post(`${t.apiUrl}/api/login`,a).then(o=>(localStorage.setItem("token",o.data.token),o.data)).catch(o=>{throw console.error("Login error:",o),o})})()}logout(){const a=localStorage.getItem("token");return r.A.post(`${this.apiUrl}/api/logout`,{},{headers:{Authorization:`Bearer ${a}`}}).then(()=>{localStorage.removeItem("token")})}getProfile(){var a=this;return(0,h.A)(function*(){const t=localStorage.getItem("token");return(yield r.A.get(`${a.apiUrl}/api/petOwner/profile`,{headers:{Authorization:`Bearer ${t}`}})).data.data})()}fetchProfileData(){var a=this;return(0,h.A)(function*(){try{const t=yield a.getProfile();return console.log("Profile response:",t),t}catch(t){throw console.error("Error fetching profile:",t),t}})()}getPetOwnerData(a){const t=localStorage.getItem("token");return r.A.get(`${this.apiUrl}/api/pet_owner/${a}`,{headers:{Authorization:`Bearer ${t}`}})}fetchPetOwnerData(a){return console.log("th id in auth=====>",a),this.getPetOwnerData(a).then(t=>(console.log("pet owner data:",t),t.data.data)).catch(t=>{throw console.error("Error fetching pet owner:",t),t})}updateProfile(a,t){const o=localStorage.getItem("token");return r.A.put(`${this.apiUrl}/api/pet_owner/${t}`,a,{headers:{Authorization:`Bearer ${o}`}})}updateProfileImage(a,t){const o=localStorage.getItem("token");return r.A.post(`${this.apiUrl}/api/pet_owner/image/${t}`,a,{headers:{Authorization:`Bearer ${o}`}})}updatePass(a,t,o){var g=this;return(0,h.A)(function*(){const R=localStorage.getItem("token");try{return(yield r.A.put(`${g.apiUrl}/api/pet-owners/update-password`,{email:a,password:t,password_confirmation:o},{headers:{Authorization:`Bearer ${R}`}})).data}catch(f){throw console.error("Error updating password:",f),f}})()}}return(_=m).\u0275fac=function(a){return new(a||_)(P.KVO(A.Qq))},_.\u0275prov=P.jDH({token:_,factory:_.\u0275fac,providedIn:"root"}),m})()},8525:(M,O,c)=>{c.d(O,{$:()=>_});var h=c(5841),r=c(496),u=c(878),P=c(5109),A=c(6200),e=c(315);r.A.defaults.withCredentials=!0;let _=(()=>{var m;class y{constructor(){this.apiUrl=`${u.c.apiUrl}/api`,r.A.interceptors.request.use(t=>{const o=localStorage.getItem("token");return o&&(t.headers.Authorization=`Bearer ${o}`),t},t=>Promise.reject(t))}getAllProviders(){return r.A.get(`${this.apiUrl}/providers`)}getProviderById(t){return r.A.get(`${this.apiUrl}/providers/${t}`)}getProviderById2(t){return(0,P.H)(r.A.get(`${this.apiUrl}/providers/${t}`)).pipe((0,A.T)(o=>o.data))}createProvider(t){return r.A.post(`${this.apiUrl}/providers`,t)}getAllProviders2(){var t=this;return(0,h.A)(function*(){return r.A.get(`${t.apiUrl}/providers`).then(o=>o.data)})()}updateProvider(t,o){return r.A.put(`${this.apiUrl}/providers/${t}`,o)}deleteProvider(t){return r.A.delete(`${this.apiUrl}/providers/${t}`)}getServicesByProviderId(t){return r.A.get(`${this.apiUrl}/providers/${t}/services`)}getProductsByProviderId(t){return r.A.get(`${this.apiUrl}/providers/${t}/products`)}getVeterinariansByProviderId(t){return r.A.get(`${this.apiUrl}/providers/${t}/veterinarians`)}getVeterianById(t){return r.A.get(`${this.apiUrl}/veterinarians/${t}`)}getServiceById(t){return r.A.get(`${this.apiUrl}/services/${t}`)}getProductById(t){return r.A.get(`${this.apiUrl}/products/${t}`)}getServiceReviewsByServiceId(t){return r.A.get(`${this.apiUrl}/services/${t}/reviews`)}getPetOwnerById(t){return r.A.get(`${this.apiUrl}/pet_owners/${t}`)}getProductReviewsByProductId(t){return r.A.get(`${this.apiUrl}/products/${t}/reviews`)}getProviderByName(t){return(0,P.H)(r.A.get(`${this.apiUrl}/providers/name/${t}`))}addReview(t){var o=this;return(0,h.A)(function*(){try{console.log("Review data before sending:",t);const g=yield r.A.post(`${o.apiUrl}/reviews`,t);return console.log("Server response:",g.data),g.data}catch(g){throw console.error("Error adding review:",g),g}})()}getAverageRatingByProviderId(t){var o=this;return(0,h.A)(function*(){try{const R=(yield o.getServicesByProviderId(t)).data;let f=0,$=0;for(const p of R)(yield o.getServiceReviewsByServiceId(p.id)).data.forEach(n=>{$+=n.rate,f++});return f>0?$/f:0}catch(g){throw console.error("Error calculating average rating:",g),g}})()}getAverageRatingByProductId(t){var o=this;return(0,h.A)(function*(){try{const R=(yield r.A.get(`${o.apiUrl}/products/${t}/reviews`)).data;return 0===R.length?null:R.reduce(($,s)=>$+s.rate,0)/R.length}catch(g){throw console.error("Error fetching reviews:",g),g}})()}}return(m=y).\u0275fac=function(t){return new(t||m)},m.\u0275prov=e.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),y})()}}]);